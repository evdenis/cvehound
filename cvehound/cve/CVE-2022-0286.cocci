/// Files: drivers/net/bonding/bond_main.c
/// Fix: 105cd17a866017b45f3c45901b394c711c97bf40
/// Fixes: 18cb261afd7bf50134e5ccacc5ec91ea16efadd4

virtual detect

@err@
identifier slave, bond;
expression real_dev;
type T;
position p;
@@

bond_ipsec_add_sa(...)
{
	...
(
*	T slave = rtnl_dereference(bond->curr_active_slave);
|
*	slave = \(rtnl_dereference\|rcu_dereference\)(bond->curr_active_slave);
)
	... when != if (!slave) { ... return -ENODEV; }
	    when any
*	real_dev = slave@p->dev;
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2022-0286')
