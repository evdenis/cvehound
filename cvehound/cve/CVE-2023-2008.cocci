/// Files: drivers/dma-buf/udmabuf.c
/// Fix: 05b252cccb2e5c3f56119d25de684b4f810ba40a
/// Fixes: 7b26e4e2119d0c5ede1282b22ce2af22835ff4b5

virtual detect

@fix_check@
identifier vmf;
@@

udmabuf_vm_fault(struct vm_fault *vmf)
{
	...
(
*	if (WARN_ON(vmf->pgoff >= ubuf->pagecount))
*		return VM_FAULT_SIGBUS;
|
*	if (pgoff >= ubuf->pagecount)
*		return VM_FAULT_SIGBUS;
)
	...
}

@err depends on !fix_check@
identifier vmf;
position p;
@@

udmabuf_vm_fault(struct vm_fault *vmf)
{
	...
*	vmf->page =@p ubuf->pages[vmf->pgoff];
	...
}


@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2023-2008')
