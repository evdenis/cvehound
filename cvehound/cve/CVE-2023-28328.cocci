/// Files: drivers/media/usb/dvb-usb/az6027.c
/// Fix: 0ed554fd769a19ea8464bb83e9ac201002ef74ad
/// Fixes: 76f9a820c8672ada12ffa0903652c9e6f2429462

virtual detect

@err@
identifier i, num, msg, value, req, index;
position p;
@@

az6027_i2c_xfer(..., struct i2c_msg msg[], int num)
{
	...
*	for (i = 0; i < num; i++) {
		...
*		if(msg[i].addr == 0x99) {
*			req = 0xBE;
* 			index = 0;
			... when != if (msg[i].len < 1) { i = -EOPNOTSUPP; break; }
*			value =@p msg[i].buf[0] & 0x00ff;
			...
		}
		...
	}
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2023-28328')
