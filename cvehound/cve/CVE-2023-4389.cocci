/// Files: fs/btrfs/disk-io.c
/// Fix: 168a2f776b9762f4021421008512dd7ab7474df1
/// Fixes: bc44d7c4b2b179c4b74fba208b9908e2ecbc1b4d

virtual detect

@err@
identifier fs_info, root, ret;
position p;
@@

\(btrfs_get_root_ref\|btrfs_get_fs_root\)(struct btrfs_fs_info *fs_info, ...)
{
	...
*	ret = btrfs_insert_fs_root(fs_info, root);
	if (ret) {
*		\(btrfs_put_root@p\|btrfs_put_fs_root@p\)(root);
		...
	}
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2023-4389')
