/// Files: io_uring/filetable.c io_uring/io_uring.c
/// Fix: 9d94c04c0db024922e886c9fd429659f22f48ea4
/// Fixes: 61c1b44a21d70d4783db02198fbf68b132f4953c
/// Version: 1.0.8

virtual detect

@fixed_fd_install@
identifier ret, file;
@@

io_fixed_fd_install(..., struct file *file, ...)
{
	...
*	if (\(ret\|unlikely(ret < 0)\))
*		fput(file);
	...
	return ret;
}

@err depends on fixed_fd_install@
identifier ret, file;
position p;
@@

io_install_fixed_file(..., struct file *file, ...)
{
	...
*	if (ret)
*		fput@p(file);
	...
*	return ret;
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2023-2236')
