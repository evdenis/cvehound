/// Files: drivers/gpu/drm/amd/amdgpu/amdgpu_cs.c
/// Fix: 2e54154b9f27262efd0cb4f903cc7d5ad1fe9628
/// Detect-To: 7a0a48ddf63bc9944b9690c6fa043ea4305f7f79

virtual detect

@err@
identifier r, fence;
position p;
@@

amdgpu_cs_wait_all_fences(...)
{
	...
	for (...;...;...) {
		...
*		r = dma_fence_wait_timeout(fence, ...);
		dma_fence_put(fence);
		...
*		if (fence->error@p)
*			return fence->error;
	}
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2023-51042')
