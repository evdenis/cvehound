/// Files: fs/nfsd/nfs4proc.c fs/nfsd/netns.h
/// Fix: e6cf91b7b47ff82b624bdfe2fdcde32bb52e71dd
/// Fixes: f4e44b393389c77958f7c58bf4415032b4cda15b

virtual detect

@waitq@
symbol nfsd_ssc_waitq;
typedef wait_queue_head_t;
@@

struct nfsd_net {
	...
*	wait_queue_head_t nfsd_ssc_waitq;
	...
};

@err depends on waitq@
symbol current, HZ;
identifier nn, work;
position p;
@@

nfsd4_ssc_setup_dul(struct nfsd_net *nn, ...)
{
	...
*	if (signal_pending(current) || (schedule_timeout(20*HZ) == 0)) {
*		kfree@p(work);
*		return ...;
*	}
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2023-1652')
