/// Files: net/rose/af_rose.c
/// Fix: 810c38a369a0a0ce625b5c12169abce1dd9ccd53
/// Fixes: v2.6.12-rc2

virtual detect

@err@
identifier amount, skb, sk;
position p;
@@

rose_ioctl(...)
{
	... when != spin_lock_irq(&sk->sk_receive_queue.lock);
*	if ((skb = skb_peek@p(&sk->sk_receive_queue)) != NULL)
*		amount = skb->len;
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2023-51782')
