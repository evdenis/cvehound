/// Files: net/key/af_key.c
/// Fix: 37bd22420f856fcd976989f1d4f1f7ad28e1fcac
/// Detect-To: d3623099d3509fa68fa28235366049dd3156c63a

virtual detect

@err_splen exists@
identifier ext_hdrs, xfilter, filter;
expression E;
binary operator cmp = {>, >=};
position p;
@@

pfkey_dump(...)
{
	...
	struct sadb_x_filter *xfilter = ext_hdrs[SADB_X_EXT_FILTER - 1];
	... when != xfilter->sadb_x_filter_splen cmp E
*	filter->splen =@p xfilter->sadb_x_filter_splen;
	...
}

@err_dplen exists@
identifier ext_hdrs, xfilter, filter;
expression E;
binary operator cmp = {>, >=};
position p;
@@

pfkey_dump(...)
{
	...
	struct sadb_x_filter *xfilter = ext_hdrs[SADB_X_EXT_FILTER - 1];
	... when != xfilter->sadb_x_filter_dplen cmp E
*	filter->dplen =@p xfilter->sadb_x_filter_dplen;
	...
}

@script:python depends on detect@
p << err_splen.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2021-0605')

@script:python depends on detect@
p << err_dplen.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2021-0605')
