/// Files: drivers/net/ethernet/sfc/ef100_nic.c
/// Fix: 407ecd1bd726f240123f704620d46e285ff30dd9
/// Fixes: b593b6f1b4921700c00394d35e098259e3d04913
/// Version: 1.1.2

virtual detect

@err@
identifier efx, mc_stats;
typedef __le64;
position p;
@@

ef100_update_stats(struct efx_nic *efx,...)
{
	...
*	__le64 *mc_stats = kmalloc(array_size(efx->num_mac_stats, sizeof(__le64)), GFP_ATOMIC);
	... when != if (!mc_stats) return 0;
*	efx_nic_copy_stats(efx, mc_stats@p);
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2022-3106')
