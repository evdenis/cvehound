/// Files: drivers/hid/amd-sfh-hid/amd_sfh_client.c
/// Fix: 53ffa6a9f83b2170c60591da1ead8791d5a42e81
/// Fixes: 4b2c53d93a4bc9d52cc0ec354629cfc9dc217f93

virtual detect

@err@
identifier cl_data, in_data, cleanup, i, rc;
position p;
@@

amd_sfh_hid_client_init(...)
{
	...
(
*	in_data->sensor_virt_addr[i] = dma_alloc_coherent(...,
*							&cl_data->sensor_dma_addr[i],
*							GFP_KERNEL);
|
*	cl_data->sensor_virt_addr[i] = dma_alloc_coherent(...,
*							&cl_data->sensor_phys_addr[i],
*							GFP_KERNEL);
)
	... when != if (!in_data->sensor_virt_addr[i]) { rc = -ENOMEM; goto cleanup; }
*	cl_data->sensor_sts[i] =@p \(SENSOR_DISABLED\|0\);
	...
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2023-3357')
