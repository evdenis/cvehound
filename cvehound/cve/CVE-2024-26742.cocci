/// Files: drivers/scsi/smartpqi/smartpqi_init.c drivers/scsi/smartpqi/smartpqi.h
/// Fix: 5761eb9761d2d5fe8248a9b719efc4d8baf1f24a
/// Fixes: cf15c3e734e8d25de7b4d9170f5a69ace633a583

virtual detect

@disable_managed_interrupts@
typedef u8;
@@

struct pqi_ctrl_info {
	...
*	u8 disable_managed_interrupts:1;
	...
};

@err depends on disable_managed_interrupts@
identifier shost, ctrl_info;
position p;
@@

pqi_map_queues(struct Scsi_Host *shost)
{
	struct pqi_ctrl_info *ctrl_info = shost_to_hba(shost);
(
*	blk_mq_pci_map_queues@p(&shost->tag_set.map[HCTX_TYPE_DEFAULT],
*			      ctrl_info->pci_dev, 0);
|
*	return blk_mq_pci_map_queues@p(&shost->tag_set.map[HCTX_TYPE_DEFAULT],
*				       ctrl_info->pci_dev, 0);
)
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2024-26742')
