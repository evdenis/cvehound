/// Files: net/smc/smc_diag.c
/// Fix: dbc153fd3c142909e564bb256da087e13fbf239c
/// Fixes: 4b1b7d3b30a6d32ac1a1dcede284e76ef8a8542d

virtual detect

@fix@
identifier smc, skb, dinfo;
@@

__smc_diag_dump(...)
{
	...
	if (... &&
*		!list_empty(&smc->conn.lgr->list) && smc->conn.rmb_desc) {
		...
		nla_put(skb, SMC_DIAG_DMBINFO, sizeof(dinfo), &dinfo)
		...
	}
	...
}

@err depends on !fix@
identifier smc, skb, dinfo;
position p;
@@

__smc_diag_dump(...)
{
	...
	if (... && !list_empty@p(&smc->conn.lgr->list)) {
		...
		nla_put(skb, SMC_DIAG_DMBINFO, sizeof(dinfo), &dinfo)
		...
	}
	...
}


@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2024-26615')
