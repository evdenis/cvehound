/// Files: drivers/gpu/drm/msm/disp/dpu1/dpu_crtc.c
/// Fix: 93340e10b9c5fc86730d149636e0aa8b47bb5a34
/// Fixes: 25fdd5933e4c0f5fe2ea5cd59994f8ac5fbe90ef

virtual detect

@err@
identifier pstates;
position p;
@@

dpu_crtc_atomic_check(...)
{
	...
*	pstates =@p kzalloc(sizeof(*pstates) * DPU_STAGE_MAX * 4, GFP_KERNEL);
	... when != if (!pstates) return -ENOMEM;
}

@script:python depends on detect@
p << err.p;
@@

coccilib.report.print_report(p[0], 'ERROR: CVE-2023-3220')
